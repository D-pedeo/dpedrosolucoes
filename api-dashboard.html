<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard APIs - D.Pedro Solu√ß√µes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #8e44ad;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #1abc9c;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --border-color: #dee2e6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        /* Header Styles */
        .kanawa-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }

        .logo span {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .top-icons {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .menu-item {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: background-color 0.3s;
        }

        .menu-item:hover {
            background-color: rgba(255,255,255,0.1);
        }

        /* Main Container */
        .main-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            padding: 1.5rem;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        .sidebar .menu-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            color: var(--text-color);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.3s;
        }

        .sidebar .menu-item:hover {
            background-color: var(--light-color);
            color: var(--primary-color);
        }

        .sidebar .menu-item.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Content Area */
        .content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .page-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            color: var(--dark-color);
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .card h2 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        /* Status Badges */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-connected {
            background-color: #d4edda;
            color: #155724;
        }

        .status-disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-warning {
            background-color: #fff3cd;
            color: #856404;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* API Metrics */
        .metric-card {
            text-align: center;
            padding: 1.5rem;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .metric-title {
            color: #666;
            font-size: 0.9rem;
        }

        /* Loading Spinner */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* API Logs */
        .api-logs {
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }

        .log-entry {
            padding: 0.5rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .log-time {
            color: #666;
            font-size: 0.7rem;
        }

        .log-success {
            color: var(--success-color);
        }

        .log-error {
            color: var(--danger-color);
        }

        .log-warning {
            color: var(--warning-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
            }
            
            .content {
                order: 1;
            }
            
            .kanawa-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .top-icons {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header class="kanawa-header">
        <div class="logo">
            <a href='DPS.html'><img src='https://i.postimg.cc/fks90nbK/DPS-ICO.jpg' alt='DPS-ICO'/></a>
            <span>D.Pedro Solu√ß√µes</span>
        </div>
        <div class="top-icons">
            <a href="DPS.html" class="menu-item"><i class="fas fa-home"></i> <span>Dashboard</span></a>
            <a href="api-dashboard.html" class="menu-item active"><i class="fas fa-plug"></i> <span>APIs</span></a>
            <a href="configuracoes.html" class="menu-item"><i class="fas fa-cog"></i> <span>Configura√ß√µes</span></a>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <a href="DPS.html" class="menu-item"><i class="fas fa-home"></i> Dashboard Principal</a>
            <a href="tokens-ia.html" class="menu-item"><i class="fas fa-robot"></i> Tokens de IA</a>
            <a href="loja-virtual.html" class="menu-item"><i class="fas fa-shopping-cart"></i> Loja Virtual</a>
            <a href="notificacoes.html" class="menu-item"><i class="fas fa-bell"></i> Notifica√ß√µes</a>
            <a href="analise.html" class="menu-item"><i class="fas fa-chart-bar"></i> An√°lise</a>
            <a href="api-dashboard.html" class="menu-item active"><i class="fas fa-plug"></i> Dashboard APIs</a>
            <a href="comunicacao.html" class="menu-item"><i class="fas fa-comments"></i> Comunica√ß√£o</a>
            <a href="configuracoes.html" class="menu-item"><i class="fas fa-cog"></i> Configura√ß√µes</a>
        </aside>

        <main class="content">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-plug"></i>
                    Dashboard de APIs - Monitoramento em Tempo Real
                </h1>
                <div>
                    <button class="btn btn-primary" id="refreshAllBtn">
                        <i class="fas fa-sync-alt"></i> Atualizar Tudo
                    </button>
                </div>
            </div>

            <!-- M√©tricas Principais -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="totalAPIs">0</div>
                        <div class="metric-title">Total de APIs</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value text-success" id="connectedAPIs">0</div>
                        <div class="metric-title">Conectadas</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value text-warning" id="warningAPIs">0</div>
                        <div class="metric-title">Com Problemas</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value text-danger" id="disconnectedAPIs">0</div>
                        <div class="metric-title">Desconectadas</div>
                    </div>
                </div>
            </div>

            <!-- Gr√°ficos -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <div class="card">
                        <h2><i class="fas fa-chart-line"></i> Performance das APIs</h2>
                        <div class="chart-container">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <h2><i class="fas fa-chart-pie"></i> Status das APIs</h2>
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Detalhado das APIs -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h2 class="mb-0"><i class="fas fa-list"></i> Status Detalhado das APIs</h2>
                    <span class="badge bg-primary" id="lastUpdate">√öltima atualiza√ß√£o: --:--:--</span>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>API</th>
                                    <th>Status</th>
                                    <th>Tempo de Resposta</th>
                                    <th>√öltima Verifica√ß√£o</th>
                                    <th>Taxa de Sucesso</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="apiStatusTable">
                                <!-- Conte√∫do carregado via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Logs em Tempo Real -->
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <h2><i class="fas fa-terminal"></i> Logs em Tempo Real</h2>
                        <div class="api-logs" id="apiLogs">
                            <!-- Logs ser√£o carregados aqui -->
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <h2><i class="fas fa-chart-bar"></i> Estat√≠sticas de Uso</h2>
                        <div class="chart-container">
                            <canvas id="usageChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configura√ß√µes de API -->
            <div class="card mt-4">
                <div class="card-header">
                    <h2><i class="fas fa-cog"></i> Configura√ß√µes de API</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">Intervalo de Verifica√ß√£o (segundos)</label>
                                <input type="number" class="form-control" id="checkInterval" value="30" min="10" max="300">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">Timeout das Requisi√ß√µes (ms)</label>
                                <input type="number" class="form-control" id="requestTimeout" value="5000" min="1000" max="30000">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-success" id="saveSettings">
                        <i class="fas fa-save"></i> Salvar Configura√ß√µes
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
// =============================================
// CONFIGURA√á√ÉO DAS APIS
// =============================================

const API_CONFIG = {
    openai: {
        name: 'OpenAI',
        url: 'https://api.openai.com/v1/models',
        type: 'ai',
        apiKey: 'sk-f4db0b3ef98346af928e33a35463295f'
    },
    websocket: {
        name: 'WebSocket',
        url: 'wss://r7f0tf7nja.execute-api.eu-north-1.amazonaws.com/production/',
        type: 'realtime'
    },
    dps: {
        loja: {
            name: 'Loja Virtual',
            url: 'https://dpedrosolucoeslda.netlify.app/loja-virtual',
            type: 'ecommerce'
        },
        tokens: {
            name: 'Tokens IA',
            url: 'https://dpedrosolucoeslda.netlify.app/tokens-ia',
            type: 'ai'
        },
        notificacoes: {
            name: 'Notifica√ß√µes',
            url: 'https://dpedrosolucoeslda.netlify.app/notificacoes',
            type: 'notification'
        },
        analise: {
            name: 'An√°lise',
            url: 'https://dpedrosolucoeslda.netlify.app/analise',
            type: 'analytics'
        },
        comunicacao: {
            name: 'Comunica√ß√£o',
            url: 'https://dpedrosolucoeslda.netlify.app/comunicacao',
            type: 'communication'
        },
        assinantes: {
            name: 'Assinantes',
            url: 'https://dpedrosolucoeslda.netlify.app/assinantes',
            type: 'subscription'
        }
    }
};

// =============================================
// SISTEMA DE MONITORAMENTO DE APIS
// =============================================

class APIDashboard {
    constructor() {
        this.apiStatus = new Map();
        this.apiStats = new Map();
        this.logs = [];
        this.checkInterval = 30000; // 30 segundos
        this.requestTimeout = 5000; // 5 segundos
        this.charts = {};
        this.init();
    }

    init() {
        this.initializeAPIs();
        this.initializeCharts();
        this.setupEventListeners();
        this.startMonitoring();
        this.loadSettings();
    }

    initializeAPIs() {
        // Inicializar status de todas as APIs
        const allAPIs = [
            { key: 'openai', ...API_CONFIG.openai },
            { key: 'websocket', ...API_CONFIG.websocket },
            ...Object.entries(API_CONFIG.dps).map(([key, config]) => ({
                key: `dps_${key}`,
                ...config
            }))
        ];

        allAPIs.forEach(api => {
            this.apiStatus.set(api.key, {
                name: api.name,
                url: api.url,
                type: api.type,
                status: 'checking',
                lastCheck: null,
                responseTime: 0,
                successRate: 100,
                totalRequests: 0,
                successfulRequests: 0
            });
        });

        this.updateMetrics();
    }

    initializeCharts() {
        // Gr√°fico de Performance
        const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        this.charts.performance = new Chart(performanceCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Tempo M√©dio de Resposta (ms)',
                        data: [],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Taxa de Sucesso (%)',
                        data: [],
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        tension: 0.4,
                        fill: true,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Tempo (ms)'
                        }
                    },
                    y1: {
                        position: 'right',
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Taxa (%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });

        // Gr√°fico de Status
        const statusCtx = document.getElementById('statusChart').getContext('2d');
        this.charts.status = new Chart(statusCtx, {
            type: 'doughnut',
            data: {
                labels: ['Conectadas', 'Com Problemas', 'Desconectadas'],
                datasets: [{
                    data: [0, 0, 0],
                    backgroundColor: ['#27ae60', '#f39c12', '#e74c3c']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Gr√°fico de Uso
        const usageCtx = document.getElementById('usageChart').getContext('2d');
        this.charts.usage = new Chart(usageCtx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'Requisi√ß√µes por API',
                    data: [],
                    backgroundColor: '#8e44ad'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    setupEventListeners() {
        // Bot√£o de atualiza√ß√£o
        document.getElementById('refreshAllBtn').addEventListener('click', () => {
            this.checkAllAPIs();
        });

        // Configura√ß√µes
        document.getElementById('saveSettings').addEventListener('click', () => {
            this.saveSettings();
        });
    }

    async checkAllAPIs() {
        const promises = [];
        
        this.apiStatus.forEach((api, key) => {
            promises.push(this.checkAPIHealth(key));
        });

        await Promise.all(promises);
        this.updateDashboard();
    }

    async checkAPIHealth(apiKey) {
        const api = this.apiStatus.get(apiKey);
        if (!api) return;

        const startTime = Date.now();
        
        try {
            let healthy = false;

            switch(apiKey) {
                case 'openai':
                    healthy = await this.checkOpenAIHealth();
                    break;
                case 'websocket':
                    healthy = await this.checkWebSocketHealth();
                    break;
                default:
                    healthy = await this.checkGenericHealth(api.url);
            }

            const responseTime = Date.now() - startTime;
            
            // Atualizar estat√≠sticas
            api.totalRequests++;
            if (healthy) api.successfulRequests++;
            api.successRate = Math.round((api.successfulRequests / api.totalRequests) * 100);

            this.apiStatus.set(apiKey, {
                ...api,
                status: healthy ? 'connected' : 'disconnected',
                lastCheck: new Date(),
                responseTime: responseTime
            });

            this.addLog(apiKey, `‚úÖ ${api.name} - ${responseTime}ms`, 'success');
            
        } catch (error) {
            const responseTime = Date.now() - startTime;
            this.apiStatus.set(apiKey, {
                ...api,
                status: 'error',
                lastCheck: new Date(),
                responseTime: responseTime
            });

            this.addLog(apiKey, `‚ùå ${api.name} - Erro: ${error.message}`, 'error');
        }
    }

    async checkOpenAIHealth() {
        try {
            const response = await fetch(API_CONFIG.openai.url, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${API_CONFIG.openai.apiKey}`
                }
            });
            return response.ok;
        } catch (error) {
            return false;
        }
    }

    async checkWebSocketHealth() {
        return new Promise((resolve) => {
            try {
                const ws = new WebSocket(API_CONFIG.websocket.url);
                let connected = false;

                const timeout = setTimeout(() => {
                    ws.close();
                    resolve(false);
                }, 3000);

                ws.onopen = () => {
                    connected = true;
                    clearTimeout(timeout);
                    ws.close();
                    resolve(true);
                };

                ws.onerror = () => {
                    clearTimeout(timeout);
                    resolve(false);
                };
            } catch (error) {
                resolve(false);
            }
        });
    }

    async checkGenericHealth(url) {
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), this.requestTimeout);
            
            const response = await fetch(url, {
                method: 'GET',
                mode: 'no-cors',
                signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            return true;
        } catch (error) {
            return false;
        }
    }

    updateDashboard() {
        this.updateMetrics();
        this.updateStatusTable();
        this.updateCharts();
        this.updateLastUpdateTime();
    }

    updateMetrics() {
        let total = 0;
        let connected = 0;
        let warning = 0;
        let disconnected = 0;

        this.apiStatus.forEach(api => {
            total++;
            if (api.status === 'connected') connected++;
            else if (api.status === 'checking') warning++;
            else disconnected++;
        });

        document.getElementById('totalAPIs').textContent = total;
        document.getElementById('connectedAPIs').textContent = connected;
        document.getElementById('warningAPIs').textContent = warning;
        document.getElementById('disconnectedAPIs').textContent = disconnected;
    }

    updateStatusTable() {
        const tableBody = document.getElementById('apiStatusTable');
        if (!tableBody) return;

        tableBody.innerHTML = '';

        this.apiStatus.forEach((api, key) => {
            const statusClass = api.status === 'connected' ? 'status-connected' :
                              api.status === 'checking' ? 'status-warning' : 'status-disconnected';
            
            const statusText = api.status === 'connected' ? 'Conectado' :
                             api.status === 'checking' ? 'Verificando' : 'Desconectado';

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <strong>${api.name}</strong><br>
                    <small class="text-muted">${api.url}</small>
                </td>
                <td>
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </td>
                <td>${api.responseTime}ms</td>
                <td>${api.lastCheck ? this.formatTime(api.lastCheck) : 'Nunca'}</td>
                <td>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-success" style="width: ${api.successRate}%"></div>
                    </div>
                    <small>${api.successRate}%</small>
                </td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="apiDashboard.testAPI('${key}')">
                        <i class="fas fa-test"></i> Testar
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    updateCharts() {
        // Atualizar gr√°fico de status
        const statusData = [0, 0, 0];
        this.apiStatus.forEach(api => {
            if (api.status === 'connected') statusData[0]++;
            else if (api.status === 'checking') statusData[1]++;
            else statusData[2]++;
        });
        this.charts.status.data.datasets[0].data = statusData;
        this.charts.status.update();

        // Atualizar gr√°fico de performance
        const now = new Date();
        const timeLabel = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();
        
        if (this.charts.performance.data.labels.length > 10) {
            this.charts.performance.data.labels.shift();
            this.charts.performance.data.datasets[0].data.shift();
            this.charts.performance.data.datasets[1].data.shift();
        }

        this.charts.performance.data.labels.push(timeLabel);
        
        // Calcular m√©dia de tempo de resposta
        let totalResponseTime = 0;
        let apiCount = 0;
        this.apiStatus.forEach(api => {
            if (api.responseTime > 0) {
                totalResponseTime += api.responseTime;
                apiCount++;
            }
        });
        const avgResponseTime = apiCount > 0 ? Math.round(totalResponseTime / apiCount) : 0;
        
        // Calcular taxa m√©dia de sucesso
        let totalSuccessRate = 0;
        this.apiStatus.forEach(api => {
            totalSuccessRate += api.successRate;
        });
        const avgSuccessRate = Math.round(totalSuccessRate / this.apiStatus.size);

        this.charts.performance.data.datasets[0].data.push(avgResponseTime);
        this.charts.performance.data.datasets[1].data.push(avgSuccessRate);
        this.charts.performance.update();

        // Atualizar gr√°fico de uso
        const labels = [];
        const data = [];
        this.apiStatus.forEach((api, key) => {
            labels.push(api.name);
            data.push(api.totalRequests);
        });

        this.charts.usage.data.labels = labels;
        this.charts.usage.data.datasets[0].data = data;
        this.charts.usage.update();
    }

    addLog(apiKey, message, type = 'info') {
        const logEntry = {
            timestamp: new Date(),
            api: apiKey,
            message: message,
            type: type
        };

        this.logs.unshift(logEntry);
        
        // Manter apenas os √∫ltimos 50 logs
        if (this.logs.length > 50) {
            this.logs.pop();
        }

        this.updateLogsDisplay();
    }

    updateLogsDisplay() {
        const logsContainer = document.getElementById('apiLogs');
        if (!logsContainer) return;

        logsContainer.innerHTML = '';

        this.logs.forEach(log => {
            const logElement = document.createElement('div');
            logElement.className = 'log-entry';
            
            const time = this.formatTime(log.timestamp);
            const logClass = log.type === 'success' ? 'log-success' : 
                           log.type === 'error' ? 'log-error' : 'log-warning';

            logElement.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="${logClass}">${log.message}</span>
            `;
            
            logsContainer.appendChild(logElement);
        });
    }

    updateLastUpdateTime() {
        document.getElementById('lastUpdate').textContent = 
            `√öltima atualiza√ß√£o: ${new Date().toLocaleTimeString('pt-BR')}`;
    }

    async testAPI(apiKey) {
        const api = this.apiStatus.get(apiKey);
        if (!api) return;

        this.addLog(apiKey, `üß™ Testando ${api.name}...`, 'warning');
        
        await this.checkAPIHealth(apiKey);
        this.updateDashboard();
    }

    startMonitoring() {
        // Verifica√ß√£o inicial
        this.checkAllAPIs();

        // Verifica√ß√µes peri√≥dicas
        setInterval(() => {
            this.checkAllAPIs();
        }, this.checkInterval);
    }

    formatTime(date) {
        return new Date(date).toLocaleTimeString('pt-BR');
    }

    loadSettings() {
        const savedInterval = localStorage.getItem('apiCheckInterval');
        const savedTimeout = localStorage.getItem('apiRequestTimeout');
        
        if (savedInterval) {
            this.checkInterval = parseInt(savedInterval) * 1000;
            document.getElementById('checkInterval').value = savedInterval;
        }
        
        if (savedTimeout) {
            this.requestTimeout = parseInt(savedTimeout);
            document.getElementById('requestTimeout').value = savedTimeout;
        }
    }

    saveSettings() {
        const interval = document.getElementById('checkInterval').value;
        const timeout = document.getElementById('requestTimeout').value;

        this.checkInterval = parseInt(interval) * 1000;
        this.requestTimeout = parseInt(timeout);

        localStorage.setItem('apiCheckInterval', interval);
        localStorage.setItem('apiRequestTimeout', timeout);

        this.addLog('system', 'Configura√ß√µes salvas com sucesso', 'success');
        
        // Reiniciar monitoramento com novas configura√ß√µes
        this.startMonitoring();
    }
}

// =============================================
// INICIALIZA√á√ÉO
// =============================================

let apiDashboard;

document.addEventListener('DOMContentLoaded', function() {
    apiDashboard = new APIDashboard();
    console.log('üöÄ Dashboard de APIs inicializado!');
});

// Expor para uso global
window.apiDashboard = apiDashboard;
    </script>
</body>
</html>